[TOC]

# 1. 后端的单元测试

### RouteServiceImpl类的测试

桩程序

```
    @BeforeEach
    void initStation() {
        stationService.addStation("1");
        stationService.addStation("2");
        stationService.addStation("3");
        stationService.addStation("4");
        stationService.addStation("5");
        stationService.addStation("6");
        routeService.addRoute("r1", Arrays.asList(1L, 2L, 3L, 4L, 5L));
        routeService.addRoute("r2", Arrays.asList(1L, 2L, 3L, 4L, 5L));
    }
```

### 测试内容

测试路线的查询

```
        RouteVO route = routeService.getRoute(1L);
        assertEquals(route.getStationIds(), Arrays.asList(1, 2, 3, 4, 5));
```

测试路线的删除和修改

```
routeService.editRoute(2L,"r3",Arrays.asList(6L, 2L, 3L, 4L, 5L));
        assertEquals(routeService.getRoute(2L).getStationIds(), Arrays.asList(6, 2, 3, 4, 5));
```

#### 初始化测试数据

- 方法名称：initStation()
- 用途：在每个测试方法执行前初始化测试数据
- 执行步骤：
  1. 添加站点 "1"
  2. 添加站点 "2"
  3. 添加站点 "3"
  4. 添加站点 "4"
  5. 添加站点 "5"
  6. 添加站点 "6"
  7. 添加路线 "r1"，包含站点ID列表 [1, 2, 3, 4, 5]
  8. 添加路线 "r2"，包含站点ID列表 [1, 2, 3, 4, 5]

#### 清理测试数据

- 方法名称：delAllStation()
- 用途：在每个测试方法执行后清理测试数据
- 执行步骤：删除所有列车数据

#### 测试方法 1

- 方法名称：test_1()
- 用途：测试获取、删除和编辑路线功能
- 测试步骤：
  1. 获取ID为 1 的路线对象，并获取其包含的站点ID列表
  2. 断言路线的站点ID列表等于预期的列表 [1, 2, 3, 4, 5]
  3. 删除ID为 1 的路线
  4. 编辑ID为 2 的路线，将路线名称修改为 "r3"，并更新站点ID列表为 [6, 2, 3, 4, 5]
  5. 获取ID为 2 的路线对象，并获取其更新后的站点ID列表
  6. 断言路线的站点ID列表等于预期的列表 [6, 2, 3, 4, 5]

## StationServiceImpl类的测试

桩程序

```
    @BeforeEach
    void initStation() {
        service.addStation("1");
        service.addStation("2");
        service.addStation("3");
        service.addStation("4");
        service.addStation("5");
        service.addStation("6");
    }
```

### 测试内容

没有重名, 添加并查找, 查找和删除

```
 void stationTest_1() {

        List<StationVO> stationVOS = service.listStations();
        List<String> stationNames = new ArrayList<String>();
        for (StationVO station : stationVOS) {
            stationNames.add(station.getName());
        }
        Collections.sort(stationNames);
        assertEquals(stationNames, Arrays.asList("1", "2", "3", "4", "5", "6"));
        StationVO stationVO = stationVOS.get(0);
        Long id = stationVO.getId();
        String name = stationVO.getName();
        service.delStation(id);
        List<String> names = service.listStations().stream().map(StationVO::getName).toList();
        assertFalse(names.contains(name));

    }
```

有重名,添加并查找,删除不存在的

```
void stationTest_2() {
        try {
            service.addStation("6");
        } catch (BizException e) {
            assertEquals(e.getMessage(), "同名站点已存在");
        }
        List<StationVO> stationVOS = service.listStations();
        List<String> stationNames = new ArrayList<String>();
        for (StationVO station : stationVOS) {
            stationNames.add(station.getName());
        }
        Collections.sort(stationNames);
        assertEquals(stationNames, Arrays.asList("1", "2", "3", "4", "5", "6"));
        StationVO stationVO = stationVOS.get(0);
        Long id = stationVO.getId();
        String name = stationVO.getName();
        try {
            service.delStation(id+10);

        } catch (Exception e) {
           e.getMessage();
        }
        assertEquals(stationNames, Arrays.asList("1", "2", "3", "4", "5", "6"));
    }
```

#### 初始化测试数据

- 方法名称：initStation()
- 用途：在每个测试方法执行前初始化测试数据
- 执行步骤：
  1. 添加站点 "1"
  2. 添加站点 "2"
  3. 添加站点 "3"
  4. 添加站点 "4"
  5. 添加站点 "5"
  6. 添加站点 "6"

#### 清理测试数据

- 方法名称：delAllStation()
- 用途：在每个测试方法执行后清理测试数据
- 执行步骤：删除所有站点数据

#### 站点测试 1

- 方法名称：stationTest_1()
- 用途：测试添加、查找和删除站点功能
- 测试步骤：
  1. 获取站点列表，并将站点名称排序后存入列表 `stationNames`
  2. 断言 `stationNames` 等于预期的站点名称列表 ["1", "2", "3", "4", "5", "6"]
  3. 获取站点列表中的第一个站点对象 `stationVO`
  4. 获取站点对象的ID和名称
  5. 删除该站点
  6. 获取当前站点列表中的所有站点名称，并存入列表 `names`
  7. 断言 `names` 不包含被删除的站点名称

#### 站点测试 2

- 方法名称：stationTest_2()
- 用途：测试添加、查找和删除站点功能（包含重名站点的情况）
- 测试步骤：
  1. 尝试添加一个已存在的站点 "6"，预期会抛出 `BizException` 异常，异常消息为 "同名站点已存在"
  2. 获取站点列表，并将站点名称排序后存入列表 `stationNames`
  3. 断言 `stationNames` 等于预期的站点名称列表 ["1", "2", "3", "4", "5", "6"]
  4. 获取站点列表中的第一个站点对象 `stationVO`
  5. 获取站点对象的ID和名称
  6. 尝试删除一个不存在的站点（使用错误的ID），预期会抛出异常，但不验证异常消息内容
  7. 断言 `stationNames` 仍然等于预期的站点名称列表 ["1", "2", "3", "4", "5", "6"]

## UserServiceImpl的测试

桩程序

```
    @BeforeEach
    void initStation() {
        service.register("user1", "123456", "user1", "323322200410155010", "15851181899", "身份证");
        service.register("user2", "123456", "user2", "323322200410155010", "15851181899", "身份证");
        service.register("user3", "123456", "user3", "323322200410155010", "15851181899", "身份证");
        service.register("user4", "123456", "user4", "323322200410155010", "15851181899", "身份证");
    }
```

### 测试内容

登录测试

```
    void test_1() {

        assertNotNull(service.findByUserName("user1"));
        assertNull(service.findByUserName("user5"));
        assertThrows(BizException.class, () -> {
            service.login("user1", "123457");
        });
        assertDoesNotThrow(() -> {
            service.login("user1", "123456");
        });

    }
```

修改用户info的测试

```
        service.editInfo("user1", "123", "123", "123", "123");
        UserEntity user1 = service.findByUserName("user1");
        assertEquals("123", user1.getName());
        assertEquals("123", user1.getPhone());
        assertEquals("123", user1.getIdn());
        assertEquals("123", user1.getType());
```

#### 初始化测试数据

- 方法名称：initStation()
- 用途：在每个测试方法执行前初始化测试数据
- 执行步骤：
  1. 注册用户 "user1"，密码 "123456"，姓名 "user1"，身份证号 "323322200410155010"，手机号 "15851181899"，证件类型 "身份证"
  2. 注册用户 "user2"，密码 "123456"，姓名 "user2"，身份证号 "323322200410155010"，手机号 "15851181899"，证件类型 "身份证"
  3. 注册用户 "user3"，密码 "123456"，姓名 "user3"，身份证号 "323322200410155010"，手机号 "15851181899"，证件类型 "身份证"
  4. 注册用户 "user4"，密码 "123456"，姓名 "user4"，身份证号 "323322200410155010"，手机号 "15851181899"，证件类型 "身份证"

#### 清理测试数据

- 方法名称：delAllStation()
- 用途：在每个测试方法执行后清理测试数据
- 执行步骤：删除所有用户数据

#### 登录测试

- 方法名称：test_1()
- 用途：测试用户登录功能
- 测试步骤：
  1. 断言用户 "user1" 存在
  2. 断言用户 "user5" 不存在
  3. 断言抛出 `BizException` 异常，当执行登录操作时使用错误的密码 "123457"
  4. 断言登录操作不会抛出异常，当执行登录操作时使用正确的密码 "123456"

#### 修改用户信息测试

- 方法名称：test_2()
- 用途：测试修改用户信息功能
- 测试步骤：
  1. 调用 `editInfo()` 方法，将用户 "user1" 的姓名、手机号、身份证号、证件类型都修改为 "123"
  2. 获取修改后的用户 "user1" 对象
  3. 断言用户 "user1" 的姓名为 "123"
  4. 断言用户 "user1" 的手机号为 "123"
  5. 断言用户 "user1" 的身份证号为 "123"
  6. 断言用户 "user1" 的证件类型为 "123"

# 单元测试

## addTrain测试

1. **测试用例名称：添加高铁列车**

   输入：

   - 列车名称： "G1"
   - 路线ID： 1L
   - 列车类型： TrainType.HIGH_SPEED
   - 日期： "2023-07-10"
   - 到达时间列表： [时间1, 时间2, 时间3]
   - 出发时间列表： [时间4, 时间5, 时间6]

   预期结果：

   - 列车实体被成功保存到数据库
   - 列车实体的座位信息根据路线的站点数量进行初始化

2. **测试用例名称：添加普速列车**

   输入：

   - 列车名称： "K2"
   - 路线ID： 2L
   - 列车类型： TrainType.NORMAL_SPEED
   - 日期： "2023-07-11"
   - 到达时间列表： [时间7, 时间8, 时间9, 时间10]
   - 出发时间列表： [时间11, 时间12, 时间13, 时间14]

   预期结果：

   - 列车实体被成功保存到数据库
   - 列车实体的座位信息根据路线的站点数量进行初始化

3. **测试用例名称：路线与到达时间列表长度不匹配**

   输入：

   - 列车名称： "G3"
   - 路线ID： 3L
   - 列车类型： TrainType.HIGH_SPEED
   - 日期： "2023-07-12"
   - 到达时间列表： [时间15, 时间16]
   - 出发时间列表： [时间17, 时间18]

   预期结果：

   - 抛出 `BizException` 异常，异常消息为 "列表长度错误"

4. **测试用例名称：路线与出发时间列表长度不匹配**

   输入：

   - 列车名称： "K4"
   - 路线ID： 4L
   - 列车类型： TrainType.NORMAL_SPEED
   - 日期： "2023-07-13"
   - 到达时间列表： [时间19, 时间20, 时间21]
   - 出发时间列表： [时间22, 时间23]

   预期结果：

   - 抛出 `BizException` 异常，异常消息为 "列表长度错误"

## changeTrain测试

1. **测试用例名称：更改列车信息**

   输入：

   - 列车ID： 1L
   - 列车名称： "G1 Updated"
   - 路线ID： 1L
   - 列车类型： TrainType.HIGH_SPEED
   - 日期： "2023-07-15"
   - 到达时间列表： [时间1 Updated, 时间2 Updated, 时间3 Updated]
   - 出发时间列表： [时间4 Updated, 时间5 Updated, 时间6 Updated]

   预期结果：

   - 列车实体的相关字段被更新成功
   - 列车实体的座位信息根据新的路线和列车类型进行初始化

2. **测试用例名称：路线与到达时间列表长度不匹配**

   输入：

   - 列车ID： 2L
   - 列车名称： "K2 Updated"
   - 路线ID： 2L
   - 列车类型： TrainType.NORMAL_SPEED
   - 日期： "2023-07-16"
   - 到达时间列表： [时间7 Updated, 时间8 Updated]
   - 出发时间列表： [时间11 Updated, 时间12 Updated, 时间13 Updated, 时间14 Updated]

   预期结果：

   - 抛出 `BizException` 异常，异常消息为 "列表长度错误"

3. **测试用例名称：路线与出发时间列表长度不匹配**

   输入：

   - 列车ID： 3L
   - 列车名称： "G3 Updated"
   - 路线ID： 3L
   - 列车类型： TrainType.HIGH_SPEED
   - 日期： "2023-07-17"
   - 到达时间列表： [时间15 Updated, 时间16 Updated, 时间17 Updated]
   - 出发时间列表： [时间22 Updated, 时间23 Updated]

   预期结果：

   - 抛出 `BizException` 异常，异常消息为 "列表长度错误"

## listTrains测试

1. **测试用例名称：列出符合条件的列车**

   输入：

   - 起始站点ID： 1L
   - 终点站点ID： 5L
   - 日期： "2023-07-20"

   预期结果：

   - 返回符合起始站点、终点站点和日期条件的列车列表

2. **测试用例名称：起始站点和终点站点不存在于任何路线中**

   输入：

   - 起始站点ID： 7L
   - 终点站点ID： 8L
   - 日期： "2023-07-20"

   预期结果：

   - 返回空的列车列表

3. **测试用例名称：指定日期没有符合条件的列车**

   输入：

   - 起始站点ID： 2L
   - 终点站点ID： 4L
   - 日期： "2023-07-21"

   预期结果：

   - 返回空的列车列表

4. **测试用例名称：起始站点在终点站点之后**

   输入：

   - 起始站点ID： 5L
   - 终点站点ID： 1L
   - 日期： "2023-07-20"

   预期结果：

   - 返回空的列车列表

## createOrder测试

1. **测试用例名称：创建订单 - 高铁列车**

   输入：

   - 用户名： "user1"
   - 列车ID： 1L
   - 起始站点ID： 2L
   - 终点站点ID： 4L
   - 座位类型： "二等座"
   - 座位数量： 1L

   预期结果：

   - 返回订单ID
   - 生成并保存订单实体到数据库

2. **测试用例名称：创建订单 - 普速列车**

   输入：

   - 用户名： "user2"
   - 列车ID： 2L
   - 起始站点ID： 3L
   - 终点站点ID： 5L
   - 座位类型： "硬座"
   - 座位数量： 1L

   预期结果：

   - 返回订单ID
   - 生成并保存订单实体到数据库

3. **测试用例名称：座位已满**

   输入：

   - 用户名： "user3"
   - 列车ID： 3L
   - 起始站点ID： 1L
   - 终点站点ID： 4L
   - 座位类型： "商务座"
   - 座位数量： 1L

   预期结果：

   - 抛出 `BizException` 异常，异常消息为 "座位已满"

4. **测试用例名称：计算订单金额和积分 - 高铁列车**

   输入：

   - 用户名： "user4"
   - 列车ID： 4L
   - 起始站点ID： 2L
   - 终点站点ID： 5L
   - 座位类型： "一等座"
   - 座位数量： 1L

   预期结果：

   - 返回订单ID
   - 生成并保存订单实体到数据库
   - 计算订单金额和积分，并存储在订单实体中

5. **测试用例名称：计算订单金额和积分 - 普速列车**

   输入：

   - 用户名： "user5"
   - 列车ID： 5L
   - 起始站点ID： 3L
   - 终点站点ID： 4L
   - 座位类型： "硬卧"
   - 座位数量： 1L

   预期结果：

   - 返回订单ID
   - 生成并保存订单实体到数据库
   - 计算订单金额和积分，并存储在订单实体中

## cancelOrder测试

1. **测试用例名称：取消待支付订单**

   输入：

   - 订单ID： 1L

   预期结果：

   - 抛出 `BizException` 异常，异常消息为 "订单状态非法"

2. **测试用例名称：取消已支付订单 - 高铁列车**

   输入：

   - 订单ID： 2L

   预期结果：

   - 更新订单状态为 "CANCELLED"
   - 退还座位给列车座位信息
   - 更新列车信息
   - 退还积分给用户
   - 返回已更新的订单实体

3. **测试用例名称：取消已支付订单 - 普速列车**

   输入：

   - 订单ID： 3L

   预期结果：

   - 更新订单状态为 "CANCELLED"
   - 退还座位给列车座位信息
   - 更新列车信息
   - 退还积分给用户
   - 返回已更新的订单实体

4. **测试用例名称：取消已完成订单**

   输入：

   - 订单ID： 4L

   预期结果：

   - 抛出 `BizException` 异常，异常消息为 "订单状态非法"

## payOrder测试

1. **测试用例名称：支付待支付订单**

   输入：

   - 订单ID： 1L

   预期结果：

   - 更新用户的积分信息
   - 调用支付策略进行支付
   - 更新订单状态为 "PAID"
   - 返回已更新的订单实体

2. **测试用例名称：支付已支付订单**

   输入：

   - 订单ID： 2L

   预期结果：

   - 抛出 `BizException` 异常，异常消息为 "订单状态非法"

## allocSeat测试

1. **测试用例名称：分配可用座位**

   输入：

   - 起始站点索引： 0
   - 终点站点索引： 3
   - 座位类型： KSeriesSeatType.A1
   - 座位图： 二维布尔数组表示的座位图

   预期结果：

   - 返回可用的座位名称（例如："A1"）
   - 更新座位图，标记相应的座位为已占用

2. **测试用例名称：没有可用座位**

   输入：

   - 起始站点索引： 1
   - 终点站点索引： 4
   - 座位类型： KSeriesSeatType.B2
   - 座位图： 二维布尔数组表示的座位图

   预期结果：

   - 返回 null，表示没有可用座位

3. **测试用例名称：起始站点和终点站点相同**

   输入：

   - 起始站点索引： 2
   - 终点站点索引： 2
   - 座位类型： KSeriesSeatType.C3
   - 座位图： 二维布尔数组表示的座位图

   预期结果：

   - 返回 null，表示没有可用座位，因为起始站点和终点站点相同

## refundSeat测试

1. **测试用例名称：退还座位**

   输入：

   - 起始站点索引： 1
   - 终点站点索引： 4
   - 座位名称： "B3"
   - 座位图： 二维布尔数组表示的座位图

   预期结果：

   - 返回更新后的座位图，将指定座位范围内的座位标记为未占用

2. **测试用例名称：座位不存在**

   输入：

   - 起始站点索引： 2
   - 终点站点索引： 5
   - 座位名称： "D2"
   - 座位图： 二维布尔数组表示的座位图

   预期结果：

   - 返回原始的座位图，没有进行任何修改

3. **测试用例名称：起始站点和终点站点相同**

   输入：

   - 起始站点索引： 3
   - 终点站点索引： 3
   - 座位名称： "C1"
   - 座位图： 二维布尔数组表示的座位图

   预期结果：

   - 返回原始的座位图，没有进行任何修改，因为起始站点和终点站点相同

## calculateRawPaymentByTrainInfo测试

1. **测试用例名称：计算原始支付金额 - 座位类型存在**

   输入：

   - 列车实体
   - 起始站点ID： 1L
   - 终点站点ID： 4L
   - 座位类型： "一等座"

   预期结果：

   - 返回指定座位类型的票价（金额）

2. **测试用例名称：计算原始支付金额 - 座位类型不存在**

   输入：

   - 列车实体
   - 起始站点ID： 2L
   - 终点站点ID： 5L
   - 座位类型： "商务座"

   预期结果：

   - 返回 0，表示座位类型不存在，无法计算原始支付金额

## calculateUsedPoints测试

1. **测试用例名称：计算订单价格 - 达到最低积分范围**

   输入：

   - 用户里程积分： 1000L
   - 车次设置的基础价格： 100.0

   预期结果：

   - 返回 99.9，表示应用了 0.1% 的折扣

2. **测试用例名称：计算订单价格 - 超过最低积分范围**

   输入：

   - 用户里程积分： 3000L
   - 车次设置的基础价格： 100.0

   预期结果：

   - 返回 99.85，表示应用了 0.15% 的折扣

3. **测试用例名称：计算订单价格 - 不足最低积分范围**

   输入：

   - 用户里程积分： 200L
   - 车次设置的基础价格： 100.0

   预期结果：

   - 返回 100.0，表示没有应用折扣，因为积分不足最低积分范围

4. **测试用例名称：计算订单价格 - 积分范围中间值**

   输入：

   - 用户里程积分： 7500L
   - 车次设置的基础价格： 100.0

   预期结果：

   - 返回 99.8，表示应用了 0.2% 的折扣

# 集成测试

## IT-01: 用户注册和订单创建的集成测试

1. 测试目标：验证用户注册和订单创建功能的集成和交互是否正常工作。
2. 测试步骤：
   - 注册用户（调用UserService的register方法）。
   - 创建订单（调用OrderService的createOrder方法）。
3. 预期结果：
   - 用户成功注册并获得唯一的用户ID。
   - 订单成功创建并获得唯一的订单ID。
   - 订单与用户的关联正确。

## IT-02: 路线和列车管理的集成测试

1. 测试目标：验证路线和列车管理功能的集成和交互是否正常工作。
2. 测试步骤：
   - 添加站点（调用StationService的addStation方法）。
   - 添加路线（调用RouteService的addRoute方法）。
   - 添加列车（调用TrainService的addTrain方法）。
   - 获取列车列表（调用TrainService的listTrains方法）。
3. 预期结果：
   - 站点成功添加并获得唯一的站点ID。
   - 路线成功添加并获得唯一的路线ID。
   - 列车成功添加并获得唯一的列车ID。
   - 列车列表包含正确的列车信息。

## IT-03: 订单支付和座位分配的集成测试

1. 测试目标：验证订单支付和座位分配功能的集成和交互是否正常工作。
2. 测试步骤：
   - 创建订单（调用OrderService的createOrder方法）。
   - 支付订单（调用OrderService的payOrder方法）。
   - 分配座位（调用TrainService的allocateSeat方法）。
3. 预期结果：
   - 订单成功创建并获得唯一的订单ID。
   - 订单成功支付并更新订单状态。
   - 座位成功分配并更新列车的座位信息。

## IT-04: 订单取消和座位退还的集成测试

1. 测试目标：验证订单取消和座位退还功能的集成和交互是否正常工作。
2. 测试步骤：
   - 创建订单（调用OrderService的createOrder方法）。
   - 取消订单（调用OrderService的cancelOrder方法）。
   - 退还座位（调用TrainService的refundSeat方法）。
3. 预期结果：
   - 订单成功创建并获得唯一的订单ID。
   - 订单成功取消并更新订单状态。
   - 座位成功退还并更新列车的座位信息。

# 系统测试

## ST-01: 用户注册和登录的系统测试

1. 测试目标：验证用户注册和登录功能在整个系统中的正确性和稳定性。
2. 测试步骤：
   - 注册新用户（通过用户注册界面完成）。
   - 使用注册的用户名和密码进行登录。
3. 预期结果：
   - 注册成功后，用户能够通过登录界面登录系统。
   - 登录成功后，系统正确显示用户的个人信息和可用功能。

## ST-02: 车次查询和预订的系统测试

1. 测试目标：验证车次查询和预订功能在整个系统中的正确性和稳定性。
2. 测试步骤：
   - 使用起始站点和目的站点进行车次查询（通过系统提供的车次查询界面）。
   - 选择符合需求的车次，并进行座位预订（通过系统提供的预订界面）。
3. 预期结果：
   - 系统能够根据提供的起始站点和目的站点正确显示可用的车次列表。
   - 用户能够选择符合需求的车次并成功预订座位。
   - 预订成功后，系统能够正确显示订单信息和更新座位状态。

## ST-03: 订单支付和退款的系统测试

1. 测试目标：验证订单支付和退款功能在整个系统中的正确性和稳定性。
2. 测试步骤：
   - 创建订单并选择支付方式进行支付（通过系统提供的订单创建和支付界面）。
   - 对已支付的订单进行退款操作（通过系统提供的订单管理界面）。
3. 预期结果：
   - 用户能够成功创建订单并选择支付方式进行支付。
   - 支付成功后，系统能够正确更新订单状态和支付信息。
   - 对已支付的订单进行退款操作时，系统能够正确处理退款并更新订单状态。

## ST-04: 系统性能和负载测试

1. 测试目标：验证系统在预期的负载和压力下的性能和稳定性。
2. 测试步骤：
   - 模拟多个用户同时进行车次查询、座位预订和订单支付等操作。
   - 增加负载和并发数，观察系统的响应时间和资源利用率。
3. 预期结果：
   - 系统能够在负载和并发情况下保持稳定，并且响应时间在可接受范围内。
   - 系统资源（如服务器、数据库等）能够正常工作，没有出现严重的性能瓶颈或资源耗尽。